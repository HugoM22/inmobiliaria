@model Inmobiliaria1.Models.Pago
@using Inmobiliaria1.Models
@{
    var c  = (Inmobiliaria1.Models.Contrato)ViewBag.Contrato;
    var ar = System.Globalization.CultureInfo.GetCultureInfo("es-AR");
    ViewData["Title"] = $"Pago #{Model.Numero}";
}
<h3>@ViewData["Title"] – contrato #@c.Id</h3>

<dl class="row">
    <dt class="col-sm-3">Fecha</dt>
    <dd class="col-sm-9">@Model.Fecha.ToString("dd/MM/yyyy")</dd>

    <dt class="col-sm-3">Importe</dt>
    <dd class="col-sm-9">@Model.Importe.ToString("C", ar) @(Model.Multa ? "(multa)" : "")</dd>

    <dt class="col-sm-3">Detalle</dt>
    <dd class="col-sm-9">@Model.Detalle</dd>

    <dt class="col-sm-3">Estado</dt>
    <dd class="col-sm-9">@Model.Estado</dd>
</dl>

@if (User.IsInRole(nameof(RolUsuario.Administrador)))
{
    <h5>Auditoría</h5>
    <dl class="row">
        <dt class="col-sm-3">Creado por</dt>
        <dd class="col-sm-9">@Model.CreadoPorUsuarioId</dd>
        <dt class="col-sm-3">Anulado por</dt>
        <dd class="col-sm-9">@(Model.AnuladoPorUsuarioId?.ToString() ?? "-")</dd>
    </dl>
}

<div class="d-flex gap-2">
    <a asp-action="Index" asp-route-contratoId="@Model.ContratoId" class="btn btn-outline-secondary">Volver</a>
    @if (Model.Estado == EstadoPago.Activo)
    {
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary">Editar detalle</a>
        @if (User.IsInRole(nameof(RolUsuario.Administrador)))
        {
            <form asp-action="Anular" method="post" class="d-inline">
                @Html.AntiForgeryToken()
                <input type="hidden" name="id" value="@Model.Id" />
                <button class="btn btn-danger" onclick="return confirm('¿Anular pago?');">Anular</button>
            </form>
        }
    }
</div>
