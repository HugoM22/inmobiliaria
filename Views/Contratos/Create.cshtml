@model Inmobiliaria1.Models.Contrato
@using Inmobiliaria1.Models
@{
    ViewData["Title"] = "Nuevo contrato";
    var ar = System.Globalization.CultureInfo.GetCultureInfo("es-AR");
}

<h2 class="mb-3">@ViewData["Title"]</h2>

<form id="form-contrato" asp-controller="Contratos" asp-action="Create" method="post" class="card p-3">
    @Html.AntiForgeryToken()

    <div asp-validation-summary="All" class="text-danger"></div>

    <div class="mb-3">
        <label asp-for="InmuebleId" class="form-label"></label>
        <select asp-for="InmuebleId" class="form-select" asp-items="ViewBag.InmuebleId" id="InmuebleId"></select>
        <span asp-validation-for="InmuebleId" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="InquilinoId" class="form-label"></label>
        <select asp-for="InquilinoId" class="form-select" asp-items="ViewBag.InquilinoId"></select>
        <span asp-validation-for="InquilinoId" class="text-danger"></span>
    </div>

    <!-- Monto mensual: NO editable -->
    <div class="mb-3">
        <label asp-for="MontoMesual" class="form-label"></label>

        <!-- el valor real que se postea -->
        <input type="hidden" asp-for="MontoMesual" id="MontoMesual" />

        <input type="text"
               class="form-control"
               id="MontoMesual_display"
               value="@(Model?.MontoMesual > 0 ? Model.MontoMesual.ToString("C", ar) : "")"
               readonly />

        <span asp-validation-for="MontoMesual" class="text-danger"></span>
        <div class="form-text">Se define por el inmueble seleccionado.</div>
    </div>

    <div class="mb-3">
        <label asp-for="FechaInicio" class="form-label"></label>
        <input asp-for="FechaInicio" type="date" class="form-control" />
        <span asp-validation-for="FechaInicio" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="FechaFin" class="form-label"></label>
        <input asp-for="FechaFin" type="date" class="form-control" />
        <span asp-validation-for="FechaFin" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Estado" class="form-label"></label>
        <select asp-for="Estado" class="form-select" asp-items="Html.GetEnumSelectList<EstadoContrato>()"></select>
        <span asp-validation-for="Estado" class="text-danger"></span>
    </div>

    <div class="d-flex gap-2">
        <a asp-action="Index" class="btn btn-outline-secondary">Volver</a>
        <button type="submit" class="btn btn-primary">Crear</button>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/localization/messages_es.min.js"></script>

    <script>
        const fmt = new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS' });

        document.getElementById("InmuebleId")?.addEventListener("change", async function () {
            const id = this.value;
            if (!id) return;
            const r = await fetch(`/Inmuebles/Precio?id=${id}`);
            if (!r.ok) return;
            const txt = await r.text();   
            const val = parseFloat(txt);

            const hidden = document.getElementById("MontoMesual");
            if (hidden) hidden.value = isNaN(val) ? "" : val;

            const disp = document.getElementById("MontoMesual_display");
            if (disp)  disp.value = isNaN(val) ? "" : fmt.format(val);
        });
    </script>
}








